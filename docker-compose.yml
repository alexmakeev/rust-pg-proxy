services:
  rustpgproxy:
    build: .
    container_name: rustpgproxy
    ports:
      - "5433:5433"
    environment:
      - UPSTREAM_HOST=${UPSTREAM_HOST}
      - UPSTREAM_PORT=${UPSTREAM_PORT:-5432}
      - UPSTREAM_USER=${UPSTREAM_USER}
      - UPSTREAM_PASSWORD=${UPSTREAM_PASSWORD}
      - UPSTREAM_DATABASE=${UPSTREAM_DATABASE}
      - LISTEN_ADDR=0.0.0.0:5433
      - CACHE_TTL_SECONDS=${CACHE_TTL_SECONDS:-900}
      - CACHE_MAX_ENTRIES=${CACHE_MAX_ENTRIES:-10000}
      - POOL_SIZE=${POOL_SIZE:-5}
      - RUST_LOG=${RUST_LOG:-info}
    restart: unless-stopped
    networks:
      - dokploy-network

networks:
  dokploy-network:
    external: true
